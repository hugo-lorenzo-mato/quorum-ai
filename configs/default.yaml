# quorum-ai Default Configuration
# Copy this file to .quorum/config.yaml in your project root

# Logging configuration
log:
  # Log level: debug, info, warn, error
  level: info
  # Output format: auto (detect TTY), text, json
  format: auto

# Trace configuration
trace:
  # Trace mode: off, summary, full
  mode: off
  # Directory for trace artifacts
  dir: .quorum/traces
  # Trace schema version
  schema_version: 1
  # Redact sensitive values in traces
  redact: true
  # Regex patterns to redact (empty uses built-in defaults)
  redact_patterns: []
  # Regex allowlist to skip redaction
  redact_allowlist: []
  # Max bytes per trace file
  max_bytes: 262144
  # Max total bytes per run
  total_max_bytes: 10485760
  # Max number of files per run
  max_files: 500
  # Phases to include in tracing
  include_phases: [refine, analyze, plan, execute]

# Workflow execution settings
workflow:
  # Maximum workflow execution time
  timeout: 16h
  # Maximum retry attempts per task
  max_retries: 3
  # Dry-run mode (simulate without executing)
  dry_run: false
  # Tools to deny during execution
  deny_tools: []
  # Heartbeat system for zombie workflow detection and recovery.
  # Heartbeat monitoring is always active and cannot be disabled.
  heartbeat:
    # How often to write heartbeats
    interval: 30s
    # When to consider a workflow zombie (no heartbeat)
    stale_threshold: 2m
    # How often to check for zombie workflows
    check_interval: 60s
    # Automatically resume zombie workflows (at least once before failing)
    auto_resume: true
    # Maximum auto-resume attempts per workflow
    max_resumes: 1

# Phase configuration
phases:
  # Analyze phase settings
  analyze:
    # Maximum duration for analyze phase
    timeout: 8h
    # Grace period after agent signals logical completion before killing the process.
    # Prevents losing output when agent CLIs hang after producing results.
    process_grace_period: "30s"
    # Prompt refiner (optional) - enhances user prompt before analysis
    refiner:
      enabled: true
      # Agent to use for refinement (model from agent's phase_models.refine)
      agent: claude
    # Analysis synthesizer - consolidates multi-agent analyses
    synthesizer:
      # Agent to use for synthesis (model from agent's phase_models.analyze)
      agent: claude
    # Semantic moderator for multi-agent consensus evaluation
    moderator:
      enabled: true
      # Agent to use for moderation (model from agent's phase_models.analyze)
      agent: claude
      # Minimum consensus score to accept (0.0-1.0)
      threshold: 0.80
      # Minimum number of agents that must succeed per analysis/refinement round
      min_successful_agents: 2
      # Minimum refinement rounds before accepting consensus
      min_rounds: 2
      # Maximum refinement rounds before giving up
      max_rounds: 3
      # Score below which to log a warning
      warning_threshold: 0.30
      # Score change below which is considered stagnation
      stagnation_threshold: 0.02
  # Plan phase settings
  plan:
    # Maximum duration for plan phase
    timeout: 1h
    # Plan synthesizer - when enabled, all agents with plan phase enabled
    # propose plans in parallel, then synthesizer consolidates them.
    # When disabled (default), uses single-agent planning with the default agent.
    synthesizer:
      enabled: false
      # Agent to use for plan synthesis (model from agent's phase_models.plan)
      agent: claude
  # Execute phase settings
  execute:
    # Maximum duration for execute phase
    timeout: 2h

# Agent configuration
# Note: temperature and max_tokens are omitted - let each CLI use its optimized defaults
#
# Each agent can have a "phases" map to control participation in workflow phases.
# This uses an OPT-IN model: only phases set to true are enabled.
# Omitted phases are disabled. If phases is empty/missing, agent is enabled for NO phases.
# Available phases: refine, analyze, moderate, synthesize, plan, execute
#
# Example - agent only for execution:
#   phases:
#     execute: true
#     # all other phases are omitted, so they are disabled
agents:
  # Default agent for analysis tasks
  default: claude

  # Claude Code CLI configuration
  claude:
    enabled: true
    path: claude
    # Default model
    model: claude-opus-4-6
    # Claude-specific: effort level (low/medium/high/max). Only supported on Opus 4.6.
    reasoning_effort: high
    # Per-task model overrides. Only specify phases that need a different model.
    # Unspecified phases use the default model above.
    phase_models:
      refine: claude-opus-4-6
      analyze: claude-opus-4-6
      moderate: claude-opus-4-6
      synthesize: claude-opus-4-6
      plan: claude-opus-4-6
      execute: claude-opus-4-6
    # Per-phase effort overrides (optional)
    reasoning_effort_phases:
      refine: max
      analyze: max
      plan: max
    # Strict allowlist: explicitly choose phases for this agent.
    phases:
      refine: true
      analyze: true
      moderate: true
      synthesize: true
      plan: true
      execute: true

  # Gemini CLI configuration
  gemini:
    enabled: true
    path: gemini
    model: gemini-3-flash-preview
    phase_models:
      refine: gemini-3-pro-preview
      analyze: gemini-3-pro-preview
      moderate: gemini-3-pro-preview
      synthesize: gemini-3-pro-preview
      plan: gemini-3-pro-preview
      execute: gemini-3-flash-preview
    phases:
      refine: true
      analyze: true
      moderate: true
      synthesize: true
      plan: true
      execute: true

  # OpenAI Codex CLI configuration
  codex:
    enabled: true
    path: codex
    model: gpt-5.3-codex
    # Codex-specific: default reasoning effort (none/minimal/low/medium/high/xhigh)
    reasoning_effort: high
    phase_models:
      refine: gpt-5.3-codex
      analyze: gpt-5.3-codex
      moderate: gpt-5.3-codex
      synthesize: gpt-5.3-codex
      plan: gpt-5.3-codex
      execute: gpt-5.3-codex
    # Per-phase reasoning effort overrides (optional)
    reasoning_effort_phases:
      refine: xhigh
      analyze: xhigh
      plan: xhigh
    phases:
      refine: true
      analyze: true
      moderate: true
      synthesize: true
      plan: true
      execute: true

  # GitHub Copilot CLI configuration (optional)
  # Uses the standalone `copilot` CLI (npm install -g @github/copilot)
  # Note: Requires GitHub Copilot Pro/Pro+/Business/Enterprise subscription
  copilot:
    enabled: false
    path: copilot
    model: claude-sonnet-4-5
    # Available models: claude-sonnet-4-5 (default), claude-opus-4.6, claude-haiku-4.5, claude-sonnet-4, gpt-5
    phase_models:
      refine: claude-sonnet-4-5
      analyze: claude-sonnet-4-5
      moderate: claude-sonnet-4-5
      synthesize: claude-sonnet-4-5
      plan: claude-sonnet-4-5
      execute: claude-sonnet-4-5
    phases:
      refine: true
      analyze: true
      moderate: true
      synthesize: true
      plan: true
      execute: true

  # OpenCode CLI configuration (optional)
  # Uses the OpenCode CLI (https://opencode.ai/docs/cli/)
  # Requires: opencode CLI installed, Ollama running at localhost:11434
  opencode:
    enabled: false
    path: opencode
    model: qwen2.5-coder
    phase_models:
      refine: qwen2.5-coder
      analyze: llama3.1
      moderate: llama3.1
      synthesize: llama3.1
      plan: llama3.1
      execute: qwen2.5-coder
    phases:
      analyze: true
      plan: true
      execute: true

# State persistence configuration
state:
  # Path to state database (SQLite)
  path: .quorum/state/state.db
  # Path to backup file
  backup_path: .quorum/state/state.db.bak
  # Lock file TTL before considered stale
  lock_ttl: 1h

# Git configuration
# Organized by lifecycle: worktree (during execution), task (progress), finalization (delivery)
git:
  # Worktree management - temporary environment during task execution
  worktree:
    # Directory where worktrees are created
    dir: .worktrees
    # When to create worktrees: always | parallel | disabled
    #   always:   every task gets its own worktree
    #   parallel: only when 2+ tasks can run concurrently (recommended)
    #   disabled: all tasks run in the main working directory (no isolation)
    mode: parallel
    # Remove worktrees after task completion
    # IMPORTANT: Requires task.auto_commit=true to prevent data loss
    auto_clean: true

  # Task progress - incremental saving after each task completes
  task:
    # Commit changes after task completes (saves work even if workflow crashes)
    auto_commit: true

  # Finalization - workflow result delivery
  # Controls how the final workflow branch is pushed and merged
  finalization:
    # Push workflow branch to remote
    auto_push: true
    # Create single pull request for the entire workflow
    auto_pr: true
    # Auto-merge: disabled by default for safety (requires human review)
    auto_merge: false
    # PR target branch. Empty string uses repository default (main/master)
    pr_base_branch: ""
    # Merge method when auto_merge is enabled: merge | squash | rebase
    merge_strategy: squash

# GitHub integration
# Note: GitHub token should be provided via GITHUB_TOKEN or GH_TOKEN environment variable
github:
  # Remote name
  remote: origin

# Report configuration (Markdown output)
report:
  # Enable/disable markdown report generation
  enabled: true
  # Base directory for report output
  base_dir: ".quorum/runs"
  # Use UTC timestamps in reports
  use_utc: true
  # Include raw agent outputs in reports
  include_raw: true

# Diagnostics configuration for process resilience
# Provides resource monitoring, crash dumps, and preflight checks
diagnostics:
  # Enable/disable diagnostics (recommended: true for long-running sessions)
  enabled: true

  # Resource monitoring configuration
  resource_monitoring:
    # How often to take resource snapshots
    interval: "30s"
    # FD usage percentage threshold for warnings (0-100)
    fd_threshold_percent: 80
    # Goroutine count threshold for warnings
    goroutine_threshold: 10000
    # Heap memory threshold in MB for warnings
    memory_threshold_mb: 4096
    # Number of snapshots to keep in history (for trend analysis)
    history_size: 120

  # Crash dump configuration
  crash_dump:
    # Directory for crash dump files
    dir: ".quorum/crashdumps"
    # Maximum number of crash dumps to keep
    max_files: 10
    # Include stack trace in crash dumps
    include_stack: true
    # Include environment variables (redacted) in crash dumps
    include_env: false

  # Preflight checks before command execution
  preflight_checks:
    # Enable preflight checks
    enabled: true
    # Minimum free FD percentage required to proceed
    min_free_fd_percent: 20
    # Minimum free memory in MB required to proceed
    min_free_memory_mb: 256

# Issue generation configuration
# Generates GitHub/GitLab issues from workflow analysis and tasks
issues:
  # Enable issue generation capability
  enabled: true
  # Issue provider: "github" or "gitlab"
  provider: github
  # Automatically generate issues when workflow completes analyze phase
  auto_generate: false
  # Timeout for issue generation operations (e.g., "3m" for 3 minutes)
  timeout: 5m
  # Issue creation mode: "direct" (gh CLI) or "agent" (LLM-based)
  mode: direct
  # Directory for draft issue files (empty = default .quorum/issues/)
  draft_directory: ""
  # Repository override (empty = auto-detect from CWD, format: "owner/repo")
  repository: ""
  # Template for parent issues (empty = default template)
  parent_template: ""
  # Template settings for issue content
  template:
    # Language for issue content: english, spanish, french, german, portuguese, chinese, japanese
    language: english
    # Tone: professional, casual, technical, concise
    tone: professional
    # Include mermaid diagrams in issue body
    include_diagrams: true
    # Title format pattern. Placeholders: {task_name}, {task_id}, {workflow_id}
    title_format: "[quorum] {task_name}"
    # Path to custom body template file (optional)
    body_template_file: ""
    # Issue convention: conventional-issues, etc. (optional)
    convention: ""
    # Custom instructions for issue generation (optional)
    custom_instructions: ""
  # Default labels to apply to generated issues
  labels:
    - quorum-generated
  # Default assignees for generated issues (GitHub usernames or GitLab user IDs)
  assignees: []
  # GitLab-specific settings
  gitlab:
    # Use epics for parent issues (requires GitLab Premium)
    use_epics: false
    # GitLab project ID (required for GitLab, auto-detected from remote otherwise)
    project_id: ""
  # AI-powered issue generation (uses LLM to generate title/body)
  generator:
    # Enable LLM-based generation. When false, issues copy artifacts directly.
    enabled: false
    # Agent to use for generation (claude, gemini, codex, etc.)
    agent: claude
    # Model to use (optional, uses agent default if empty)
    model: haiku
    # Summarize content instead of copying verbatim
    summarize: true
    # Maximum body length in characters
    max_body_length: 8000
    # Reasoning effort for the generator agent (empty = agent default)
    reasoning_effort: ""
    # Custom instructions for issue body generation (optional)
    instructions: ""
    # Custom instructions for issue title generation (optional)
    title_instructions: ""
