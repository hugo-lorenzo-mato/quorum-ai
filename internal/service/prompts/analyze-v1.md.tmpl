# Analysis Request

## User Prompt
{{.Prompt}}

## Project Context
{{.Context}}

## Context Management

Your context is limited. Optimize its use with these strategies:

1. **Locate before reading**
   - Use grep/ripgrep to find relevant files before reading them completely
   - Use glob to identify file patterns (e.g.: `*_test.go`, `*/handlers/*.ts`)

2. **Selective reading**
   - If a file >300 lines, read only the relevant sections (line ranges)
   - Extract specific functions/classes, not entire files
   - Prioritize: interfaces > implementations, public > private

3. **Delegation**
   - For deep exploration of subsystems, use sub-agents or background tasks
   - Each sub-task should return a summary, not raw content

4. **Progressive synthesis**
   - Summarize findings immediately after each reading
   - Do not accumulate raw content in your context
   - Maintain a mental index: file → purpose → key finding

5. **Prioritization**
   - Start with entry points and configuration
   - Follow dependencies only when necessary
   - Ignore generated files, vendors, and node_modules

## Instructions

Analyze the codebase **exhaustively and in depth**. Your analysis must:

1. **Investigate the code** - Read files, understand the architecture, identify patterns
2. **Ground each statement** - Cite specific files and lines as evidence
3. **Identify real risks** - Based on code, not assumptions
4. **Propose actionable recommendations** - Specific and prioritized

**Do not omit any relevant aspect.** Provide a complete and detailed analysis with specific code evidence. Generate your analysis in markdown format, structuring it with the sections you consider most appropriate to communicate your findings clearly and effectively.

## OUTPUT SIZE CONSTRAINT (MANDATORY)

Your entire output (including any tool call inputs) MUST fit within the model's output token limit.

- Prefer density over length (tables, bullet lists).
- Avoid long code blocks; cite `file:line` instead.
- If you cannot fit everything, prioritize: current-state facts + exploit paths + concrete mitigations + rollout + test matrix.

## CRITICAL: SELF-CONTAINED DOCUMENT REQUIREMENTS

Your analysis must be a **COMPLETE, SELF-CONTAINED DOCUMENT** that can be read and understood in isolation:

### 1. Zero External Dependencies
- **DO NOT** assume the reader has access to any other document
- **DO NOT** reference external sources, prior conversations, or other analyses
- **INCLUDE ALL** context necessary to understand each finding
- Your document must be the **SINGLE SOURCE OF TRUTH** for the reader

### 2. Comprehensive Content for Future Phases
Your analysis will be used by **planning** and **execution** phases. Include:
- **Architecture Overview**: Complete understanding of the system structure
- **Component Relationships**: How parts interact (include ASCII diagrams)
- **Data Flows**: How information moves through the system
- **Extension Points**: Where and how the system can be extended
- **Constraints and Limitations**: Technical boundaries that must be respected

### 3. Visual Aids (ASCII Diagrams)
Include ASCII diagrams to illustrate:
- System architecture and component relationships
- Data flow between modules
- Decision trees for complex logic
- State machines if applicable
- Directory structures when relevant

Example format:
```
+------------------+     +------------------+
|   Component A    |---->|   Component B    |
+------------------+     +------------------+
        |                        |
        v                        v
+------------------+     +------------------+
|   Component C    |<----|   Component D    |
+------------------+     +------------------+
```

### 4. Step-by-Step Guidance
For complex findings, provide:
- Clear sequential explanations
- Numbered steps where appropriate
- Decision criteria with rationale
- Trade-off analysis with evidence

### 5. Evidence-Rich Content
Every claim must include:
- **File path and line number**: `path/to/file.go:123`
- **Code snippets**: When they clarify the point (keep them focused)
- **Quantitative data**: Counts, sizes, complexity metrics when relevant

### 6. Structured for Downstream Consumption
Organize your analysis so that:
- A planner can extract actionable items without ambiguity
- An executor can understand the technical context completely
- A reviewer can verify claims against the cited evidence
- **No follow-up questions should be necessary** to understand your analysis

{{if .Constraints}}
## Constraints
{{range .Constraints}}- {{.}}
{{end}}{{end}}
{{if .OutputFilePath}}

---
## Output Location

Write your complete analysis to the following file:

```
{{.OutputFilePath}}
```

## INCREMENTAL WRITING (MANDATORY)

To avoid output token limits, write the file in **multiple tool calls**:

1. First tool call: create the file with a short skeleton (headings only).
2. Then write **one top-level section per tool call** (keep each section concise and evidence-dense).
3. After each tool call finishes, continue with the next section in a new tool call.
4. Do NOT try to write the entire document in a single tool call.

**IMPORTANT - File format:**
- Write ONLY the analysis content in markdown
- DO NOT add YAML frontmatter (`---` ... `---` blocks at the beginning)
- DO NOT add metadata, file headers, or system information
- DO NOT include markers like `# File:` or file comments
- Content must start directly with your analysis

Use your file writing tool to create this markdown document.
{{end}}
